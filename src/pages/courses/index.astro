---
import { getCollection } from 'astro:content';
import Layout from '~/layouts/Layout.astro';
import CourseCard from '~/components/CourseCard.astro';
import CourseMap from '~/components/CourseMap.astro';
import Grid from '~/components/Grid.astro';
import Panel from '~/components/Panel.astro';
import Prose from '~/components/Prose.astro';

const courses = await getCollection('courses');
courses.sort((a, b) => a.data.title.localeCompare(b.data.title));

// Prepare courses for map - parse GeoJSON location data
const coursesForMap = courses.map(course => {
	let location = undefined;

	if (course.data.location) {
		try {
			const parsed = JSON.parse(course.data.location);
			if (parsed.type === 'Point' && parsed.coordinates) {
				// GeoJSON uses [longitude, latitude] order
				location = { lat: parsed.coordinates[1], lng: parsed.coordinates[0] };
			}
		} catch (e) {
			// Ignore parse errors
		}
	}

	return {
		name: course.data.title,
		slug: course.slug,
		suburb: course.data.suburb,
		thumbnail: course.data.thumbnail || course.data.mainImage,
		location
	};
}).filter(c => c.location);
---

<Layout title="Melbourne Disc Golf Courses" subtitle="Discover amazing disc golf courses across Melbourne">
	{coursesForMap.length > 0 && (
		<div class="my-8">
			<CourseMap courses={coursesForMap} />
		</div>
	)}

	<Grid cols={3}>
		{courses.map((course) => (
			<CourseCard
				name={course.data.title}
				href={`/courses/${course.slug}`}
				location={course.data.suburb}
				image={course.data.thumbnail || course.data.mainImage}
			/>
		))}
	</Grid>

	<Prose class="text-center">
		<h2>Further afield</h2>
	</Prose>

	<Grid cols={2}>
		<Panel class="bg-gray-50 prose text-center mt-0">
			<h3>Victoria & Australia</h3>
			<p>
				Visit <a href="https://flyspot.com.au" target="_blank"><b>flyspot.com.au</b></a>
				for comprehensive information about disc golf courses across the country.
			</p>
		</Panel>

		<Panel class="bg-gray-50 prose text-center mt-0">
			<h3>Worldwide</h3>
			<p>
				<a href="https://udisc.com" target="_blank"><b>UDisc</b></a> is a great place
				to find information about disc golf courses around the world.
			</p>
		</Panel>
	</Grid>

</Layout>

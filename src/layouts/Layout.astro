---
import '~/styles/global.css'
import logoImage from '~/assets/images/mdgc-logo.png';
import { getNavItems, type NavItem } from '~/data/navigation.ts';
import { Icon } from 'astro-icon/components'

export interface Props {
  title: string;
  subtitle?: string;
}

const { title, subtitle } = Astro.props;

// Check if current page is under a nav item
function isActiveNavItem(itemHref: string): boolean {
  if (itemHref === '/' && currentPath === '/') return true;
  if (itemHref !== '/' && currentPath.startsWith(itemHref)) return true;
  return false;
}

// Get color class for nav item based on active state
function navItemColor(itemHref: string): string {
  return isActiveNavItem(itemHref) ? 'text-white' : 'text-mdgc-blue-light';
}

const currentPath = Astro.url.pathname;

// Get navigation items dynamically
const navItems: NavItem[] = await getNavItems();

// Get footer navigation with only featured courses
const footerSections: NavItem[] = await getNavItems(true);

// Favicon sizes to generate links for
const faviconSizes = [16, 32, 48, 192];
---

<!doctype html>
<html lang="en">
	<head>
		<title>{title} | Melbourne Disc Golf Club</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet" />
		{faviconSizes.map(size => (
			<link rel="icon" type="image/png" sizes={`${size}x${size}`} href={`/images/favicon-${size}x${size}.png`} />
		))}
	</head>
	<body>
		<header>
			<div id="menu-strip" class="bg-gradient-to-b from-mdgc-blue-dark to-slate-900 text-white shadow-lg">
				<div id="menu-content" class="extra-width flex items-center h-16 space-x-8">
					<div id="menu-logo" class="flex items-center gap-3">
						<a href="/" title="Home" class="logo-link">
							<img src={logoImage.src} alt="Melbourne Disc Golf Club" class="h-12 w-auto" />
						</a>
						<span class="lg:text-lg font-display">Melbourne Disc Golf</span>
					</div>

					<div id="menu-links" class="ml-auto">
						<nav class="hidden md:flex items-center space-x-8">
							{navItems.map(item => (
								item.subPages ? (
									<div class="relative group">
										<div class="flex items-center">
											<a href={item.href} class={`${navItemColor(item.href)} hover:text-white transition-colors`}>{item.title}</a>
											<button class={`ml-1 ${navItemColor(item.href)} hover:text-white transition-colors`}>
												<Icon name="heroicons:chevron-down" class="h-4 w-4" />
											</button>
										</div>
										<div class="absolute -left-4 mt-0 w-56 bg-slate-800 text-mdgc-blue-light rounded-md shadow-xl hidden group-hover:block z-[1000] pt-2">
											{item.subPages.map(subItem => (
												<a href={subItem.href} class={`block px-4 py-2 hover:bg-mdgc-blue-dark hover:text-white transition-colors ${navItemColor(subItem.href)}`}>{subItem.title}</a>
											))}
										</div>
									</div>
								) : (
									<a href={item.href} class={`${navItemColor(item.href)} hover:text-white transition-colors`}>{item.title}</a>
								)
							))}
						</nav>
					</div>

					<!-- Mobile menu button -->
					<div class="md:hidden ml-auto">
						<button id="mobile-menu-button" class="text-mdgc-blue-light hover:text-white">
							<Icon name="heroicons:bars-3" class="h-6 w-6" />
						</button>
					</div>
				</div>

				<!-- Mobile menu -->
				<div id="mobile-menu" class="md:hidden hidden">
					<nav class="px-2 pt-2 pb-3 space-y-1">
						{navItems.map(item => (
							item.subPages ? (
								<div>
									<a href={item.href} class={`block px-3 py-2 hover:bg-mdgc-blue-dark rounded-md font-semibold ${navItemColor(item.href)} hover:text-white transition-colors`}>{item.title}</a>
									{item.subPages.map(subItem => (
										<a href={subItem.href} class={`block px-6 py-1 text-sm hover:bg-mdgc-blue-dark rounded-md ${navItemColor(subItem.href)} hover:text-white transition-colors`}>{subItem.title}</a>
									))}
								</div>
							) : (
								<a href={item.href} class={`block px-3 py-2 hover:bg-mdgc-blue-dark rounded-md ${navItemColor(item.href)} hover:text-white transition-colors`}>{item.title}</a>
							)
						))}
					</nav>
				</div>
			</div>

			<div class="bg-mdgc-blue-dark text-white">
				<div id="title-content" class="content-width p-8">
					<div id="title-and-subtitle">
						<h1 class="text-4xl font-bold">{title}</h1>
						{subtitle && <p class="text-xl mt-4">{subtitle}</p>}
					</div>
				</div>
			</div>
		</header>

		<main class="content-width">
			<slot />
		</main>

		<div class="bg-gray-900 text-white">
			<footer class="extra-width sm:px-6 lg:px-8 py-12">
				<div class="flex flex-row gap-24">
					<!-- Logo section -->
					<div class="flex-shrink-0">
						<a href="/" title="Home" class="logo-link">
							<img src={logoImage.src} alt="Melbourne Disc Golf Club" class="h-16 w-auto" />
						</a>
					</div>

					<!-- Navigation sections grid -->
					<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4 mx-auto">
						{footerSections.map(section => (
							<div>
								<h3 class="font-semibold mb-2">
									<a href={section.href} class={`inline-block ${navItemColor(section.href)} hover:text-white transition-colors`}>
										{section.title}
									</a>
								</h3>
								{section.subPages && (
									<ul class="space-y-1">
										{section.subPages.map(link => (
											<li>
												<a href={link.href} class={`inline-block text-sm ${navItemColor(link.href)} hover:text-white transition-colors`}>
													{link.title}
												</a>
											</li>
										))}
									</ul>
								)}
							</div>
						))}
					</div>
				</div>

				<!-- Bottom section -->
				<div class="border-t border-gray-700 mt-8 pt-2 flex flex-col md:flex-row justify-between items-center gap-4">
					<div class="text-gray-400 text-sm text-center md:text-left">
						<p>Â© {new Date().getFullYear()} Melbourne Disc Golf Club. All rights reserved.</p>
						<p class="text-xs text-gray-500 mt-1">last updated: {new Date().toLocaleString('en-AU', { timeZone: 'Australia/Melbourne', dateStyle: 'medium', timeStyle: 'short' })}</p>
					</div>
					<div class="flex items-center gap-4">
						<a href="https://github.com/mdub/mdgc" target="_blank" rel="noopener noreferrer" class="inline-block text-gray-400 hover:text-white transition-colors" aria-label="View source on GitHub" title="View source on GitHub">
							<Icon name="mdi:github" class="h-5 w-5" />
						</a>
						<a href="/admin" class="inline-block text-gray-400 hover:text-white transition-colors" aria-label="Content management" title="Open CMS">
							<Icon name="mdi:pencil" class="h-5 w-5" />
						</a>
					</div>
				</div>
			</footer>
		</div>
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}

	.logo-link {
		display: inline-block;
	}

	.logo-link:hover {
		transform: scale(1.15);
	}
</style>

<script>
	const mobileMenuButton = document.getElementById('mobile-menu-button');
	const mobileMenu = document.getElementById('mobile-menu');

	mobileMenuButton?.addEventListener('click', () => {
		mobileMenu?.classList.toggle('hidden');
	});
</script>
